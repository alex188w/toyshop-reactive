# Приложение "Витрина интернет-магазина" с использованием Spring Framework

## Требования и функциональность
* Веб-приложение "Витрина интернет-магазина", написанное на Spring Framework с использованием стартера (надстройки) - Spring Boot (версия 3.5.4 ); в качестве сервера приложений (embedded server) - используется встроенный по умолчанию Apache Tomcat. 
* Код приложения хранится в Git-репозитории (Github) по адресу: https://github.com/alex188w/toyshop.
* Образ контейнера Docker доступен по адресу: https://hub.docker.com/repository/docker/alex188w/toyshop.
* Сборка приложения осуществляется с помощью Maven (build system), которая управляет зависимостями и сборкой приложения.
* Код приложения написан на Java 21.
* База данных - PostgreSQL.
* Приложение использует Spring Data JPA и Hibernate ORM под капотом для доступа к данным в базе данных.
* Компиляция и запуск Spring Boot приложения на встроенном сервлет-контейнере Tomcat.
* Приложение покрыто тестами (юнит-, интеграционными) с использованием JUnit 5, TestContext Framework, Spring Boot Test и кеширования контекстов.

Веб-приложение представляет собой витрину товаров, которые пользователь может положить в корзину и купить.
* Приложение состоит из шести основных частей (модулей): страница витрины товаров, доступных для просмотра и покупки; страница товара; страница корзины покупателя; страница всех заказов; страница заказа; сервис покупки.

1. Страница витрины товаров — это веб-страница (html + javascript), на которой представлены:

- список товаров, доступных для заказа (картинка, название, цена, кнопка добавления в корзину/удаления из неё, кнопка изменения количества товара в корзине);

- список товаров может быть представлен в любом виде (списком, плиткой);
есть пагинация (по 10, 20, 50, 100 товаров);

- сверху строка поиска с фильтрацией по названию (можно просто по вхождению слова в название/описание товара);
сверху доступна фильтрация по цене, алфавиту.

2. При нажатии на товар происходит переход на веб-страницу карточки товара, на которой представлены:

- название, картинка, описание товара, возможность положить товар в корзину/удалить его, изменить количество в корзине;

- цена товара.

3. В правом верхнем углу любой веб-страницы есть кнопка перехода в корзину, которая представляет собой:
- веб-страницу со списком положенных в неё товаров, их количеством, ценой каждого товара и общей ценой всей корзины;
- есть возможность удалить товар из корзины, изменить его количество;
- есть кнопка оформления заказа.

На веб-странице корзины представлен список добавленных товаров (картинка, название, цена).
При нажатии на кнопку оформления заказа происходит эмуляция оформления заказа, при этом происходит переход на страницу оформленного заказа.

4. В правом верхнем углу любой веб-страницы есть кнопка перехода на страницу заказов, которая представляет собой:
- веб-страницу со списком всех оформленных заказов, суммой каждого заказа и общей суммой всех заказов;
- при нажатии на заказ появляется веб-страница совершённого заказа.

Дополнительно реализована страница добавления товара, на которой есть возможность добавить наименование товара, описание товара, его стоимость, количество и загрузить изображение.

Скриншоты основных страниц приложения приведены в конце описания.


## Краткое описание работы приложения

Для корректной работы приложения в корне проекта нужно создать файл .env (нет на GitHub и DockerHub) с переменными окружения следующего содержания:

    # Если проект запускаем локально на хостовой машине
    # DB_URL=jdbc:postgresql://localhost:5432/toyshop

    # Если проект запускаем в контейнере и обращаемся к БД на хостовой машине
    DB_URL=jdbc:postgresql://host.docker.internal:5432/toyshop

    # Для загрузки изображений Виндовс
    # upload.dir=C:/myapp/uploads/toyshop

    # Для загрузки изображений - приложение в контейнере
    UPLOAD_DIR=/uploads/toyshop

    DB_USER=your_db_name
    DB_PASS=your_db_password
    SERVER_PORT=8085


Для того, чтобы Spring Boot автоматически подхватил .env - создан файл src\main\resources\META-INF\spring.factories — конфигурационный файл Spring Boot, в котором указываются классы, которые должны автоматически подхватываться при старте приложения следующего содержания (может отличаться в вашей конфигурации):

    org.springframework.boot.env.EnvironmentPostProcessor=example.toyshop.config.DotenvEnvironmentPostProcessor

В этом файле прописан путь к классу DotenvEnvironmentPostProcessor, который подгружает переменные из .env в Environment ДО старта контекста Spring.

Приложение использует БД PostgreSQL. До запуска приложения необходимо создать БД (напр. toyshop). Если имя БД отличается, нужно прописать его в /env в строке: DB_URL=jdbc:postgresql://host.docker.internal:5432/toyshop. Логин и пароль к БД прописываются в строках:

    DB_USER=your_db_name
    DB_PASS=your_db_password

Порт сервера приложения прописан в строке: SERVER_PORT=...


## Запуск приложения в работу

1. Сборка и запуск приложения из исходников локально на хостовой машине ОС Виндовс (БД должна быть запущена на хостовой машине) возможно командой: **mvn spring-boot:run**

При этом: 

    Собирается проект (компилирует Java-код, копирует ресурсы, прогоняет аннотации).

    Поднимается приложение прямо из исходников — без явного создания JAR.

    Подтягиваются зависимости на лету из локального Maven-репозитория (~/.m2/repository).

    Передаются в приложение все свойства (из application.properties и переменных окружения).

    Проект остается в «живом» состоянии — пока не остановим процесс (Ctrl+C).

Приложение открывается по адресу: http://localhost:8085/products

Для корректной работе надо раскомментировать/закомментировать строки в файле .env следующим образом:

    # Если проект запускаем локально на хостовой машине
    DB_URL=jdbc:postgresql://localhost:5432/toyshop

    # Если проект запускаем в контейнере и обращаемся к БД на хостовой машине
    # DB_URL=jdbc:postgresql://host.docker.internal:5432/toyshop

    # Для загрузки изображений Виндовс
    upload.dir=C:/myapp/uploads/toyshop

    # Для загрузки изображений - приложение в контейнере
    # UPLOAD_DIR=/uploads/toyshop

2. Запуск Executable JAR в Docker-контейнер с открытым веб-портом для доступа из браузера (8085) с использованием Docker и Docker Compose

В корне проекта создан файл - Dockerfile, в котором описываются инструкции для сборки образа Docker — шаги, которые скажут Docker, как подготовить среду для приложения.

Также в корне проекта создан файл docker-compose.yml, в котором описывается, как запускать контейнер — с его настройками, сетями, томами и переменными окружения. Здесь же настроен том (volumes):  

    volumes:
        - C:/myapp/uploads/toyshop:/uploads/toyshop

для того, чтобы папка с загрузками была смонтирована и была доступна из хоста в контейнер
  
Docker и DockerCompose должны быть установлены и запущены на компьютере. Проверить можно командой:

    •	Версия Docker: docker --version
    •	Версия Docker Compose: docker compose version


Запуск приложения возможен одним из следующих вариантов:

    2.1. Скачать приложение из репозитория ДокерХаб командой: docker pull alex188w/toyshop:latest

    Запустить с указанием файла .env (файл должен быть доступен в корне проекта) командой: docker run --env-file .env -p 8085:8080 alex188w/toyshop:latest

    Приложение будет доступно в браузере по адресу: http://localhost:8085/products


    2.2. Чистим и собираем fat JAR из исходников командой: mvn clean package -DskipTests

    После этого в папке target/ появится файл toyshop.jar

    Затем нужно либо:
    
    2.2.1. Собрать образ вручную (если нужно)	docker build -t toyshop . и запустить командой: docker run --env-file .env -p 8085:8080 alex188w/toyshop:latest

    2.2.2. Запустить через Docker Compose командой:	docker compose up --build.

    После этого приложение будет доступно в браузере по адресу: http://localhost:8085/products


## Тестирование

Интеграционное тестирвание выполняется проводятся в условиях, максимально приближенных к реальной среде выполнения приложения с использованием Testcontainers с PostgreSQL для Spring Boot.

Этот метод имеет следующие преимущества:

    Изоляция: тесты не зависят от локальной базы данных или внешних сервисов.

    Воспроизводимость: одна и та же конфигурация базы для всех тестов и разработчиков.

    Чистая база: можно легко сбрасывать состояние между тестами или перед каждым запуском.

    Быстрый старт/стоп: контейнер запускается и останавливается быстро.

    Контроллеры и сервисы подключаются к реальному слою данных через полноценный Spring-контекст.

Всего для покрытия Приложения тестами (юнит-, интеграционными) с использованием JUnit 5, TestContext Framework, Spring Boot Test и кеширования контекстов, создано 46 тестов.

Запуск всех тестов выполняется командой: mvn test

Запуск отдельно класса с тестами командой: mvn test -Dtest=TestClassName

Результаты тестирования:


![Результаты тестирования](img/testResult.jpg)




## Скрины основных страниц приложения:

Главная страница прилоржения:

![Главная страница](img/products.jpg)

Страница товара:

![Страница товара](img/product.jpg)

Страница корзины:

![Страница корзины](img/cart.jpg)

Страница заказа:

![Страница заказа](img/order.jpg)

Страница заказов:

![Страница заказов](img/orders.jpg)

Страница добавления товара:

![Страница заказов](img/product-add.jpg)