# Приложение "Витрина интернет-магазина" с сервисом платежей с использованием Spring Framework

    На основе разработанной OpenAPI спецификации сгенерированы:

клиент основного сервиса для осуществления запросов в сервис платежей;


REST-контроллер сервиса платежей для приёма запросов от основного приложения.


Основное приложение «Витрина интернет-магазина» и сервис платежей  реализованы как подпроекты одного мультипроекта и собираються с помощью систем сборки Maven.

## Требования и функциональность

## Основное приложение
* Веб-приложение "Витрина интернет-магазина", написанное на Spring Framework с использованием стартера (надстройки) - Spring Boot (версия 3.5.4 ). 
* Web UI приложения использует Spring WebFlux и подключается через соответствующий стартер.
* Приложение использует Spring Data R2DBC для доступа к данным в БД.
* База данных приложения - PostgreSQL с реактивным драйвером r2dbc-postgresql.
* Приложение упаковано в Executable JAR и запускается в Embedded Web Server (Netty).
* Разработана и осуществлена возможность запуска Executable JAR в Docker-контейнер с открытым веб-портом для доступа из браузера (8085) с использованием Docker и Docker Compose.
* Код приложения хранится в Git-репозитории (Github) по адресу: https://github.com/alex188w/toyshop-reactive.
* Образ контейнера Docker доступен по адресу: https://hub.docker.com/repository/docker/alex188w/storefront.
* Сборка приложения осуществляется с помощью Maven (build system), которая управляет зависимостями и сборкой приложения.
* Код приложения написан на Java 21.
* Приложение покрыто тестами (юнит-, интеграционными) с использованием Spring Boot Test, Spring WebFlux и Spring Data R2DBC.

Веб-приложение представляет собой витрину товаров, которые пользователь может положить в корзину и купить.
* Приложение состоит из шести основных частей (модулей): страница витрины товаров, доступных для просмотра и покупки; страница товара; страница корзины покупателя; страница всех заказов; страница заказа; сервис покупки.

1. Страница витрины товаров — это веб-страница (html + javascript), на которой представлены:

- список товаров, доступных для заказа (картинка, название, цена, кнопка добавления в корзину/удаления из неё, кнопка изменения количества товара в корзине);

- список товаров может быть представлен в любом виде (списком, плиткой);
есть пагинация (по 10, 20, 50, 100 товаров);

- сверху строка поиска с фильтрацией по названию (можно просто по вхождению слова в название/описание товара);
сверху доступна фильтрация по цене, алфавиту.

2. При нажатии на товар происходит переход на веб-страницу карточки товара, на которой представлены:

- название, картинка, описание товара, возможность положить товар в корзину/удалить его, изменить количество в корзине;

- цена товара.

3. В правом верхнем углу любой веб-страницы есть кнопка перехода в корзину, которая представляет собой:
- веб-страницу со списком положенных в неё товаров, их количеством, ценой каждого товара и общей ценой всей корзины;
- есть возможность удалить товар из корзины, изменить его количество;
- есть кнопка оформления заказа.

На веб-странице корзины представлен список добавленных товаров (картинка, название, цена).
При нажатии на кнопку оформления заказа происходит эмуляция оформления заказа, при этом происходит переход на страницу оформленного заказа.

4. В правом верхнем углу любой веб-страницы есть кнопка перехода на страницу заказов, которая представляет собой:
- веб-страницу со списком всех оформленных заказов, суммой каждого заказа и общей суммой всех заказов;
- при нажатии на заказ появляется веб-страница совершённого заказа.

Дополнительно реализована страница добавления товара, на которой есть возможность добавить наименование товара, описание товара, его стоимость, количество и загрузить изображение.

Скриншоты основных страниц приложения приведены в конце описания.


## Краткое описание работы приложения

Приложение использует БД PostgreSQL. До запуска приложения в работу необходимо создать БД (напр. toyshop). 
    
Для корректной работы приложения в корне проекта нужно создать файлы:

1. для работы в локальной среде: 
storefront\src\main\resources\application-local.yml

    spring:
    r2dbc:
        url: r2dbc:postgresql://localhost:5432/toyshop
        username: your_userName
        password: your_userPassword
    data:
        redis:
        host: localhost
        port: 6379

    payment:
    service:
        url: http://localhost:8081


2. для работы в контейнере: 

storefront\src\main\resources\application-docker.yml

    spring:
        r2dbc:
            url: r2dbc:postgresql://host.docker.internal:5432/toyshop
            username: your_userName
            password: your_userPassword
        data:
            redis:
            host: redis
            port: 6379

        payment:
        service:
            url: http://payment-service:8081


Название БД прописано в строке (изменить при необходимости):

    url: r2dbc:postgresql://host.docker.internal:5432/db_name

## Сервис платежей представляет собой RESTful-приложение с двумя реактивными HTTP-эндпоинтами:

* получением баланса на счёте (на ваш выбор логика получения баланса: случайный баланс, загрузка из БД, фиксированный баланс, загрузка из конфига) — если баланс меньше суммы цены товаров в корзине, то кнопка оформления заказа основного приложения недоступна;

* осуществлением платежа (при нажатии на кнопку оформления заказа происходит запрос на вычитание суммы заказа из баланса) — если оно даёт отрицательный результат, то считается, что оплата заказа не прошла и он не оформляется, и выдаётся соответствующая ошибка.

Образ контейнера доступен по адресу: https://hub.docker.com/repository/docker/alex188w/payment-service


Сервер Redis использeтся в качестве кеша товаров, может быть установлен как локально (при разработке в локальной среде), так и в Docker-контейнере (при запуске приложения в контейнере)

## Запуск приложения в работу

1. Сборка и запуск приложения из исходников локально на хостовой машине ОС Виндовс (БД должна быть запущена на хостовой машине) возможно командми:

 **mvn spring-boot:run -pl paymentService** - запуск сервиса платежей

 **mvn spring-boot:run -pl storefront "-Dspring-boot.run.profiles=local"** - запуск основного приложения

 Сервис Redis должен быть обязательно запущен на хостовой машине!

При этом: 

    Собирается приложения (компилирует Java-код, копирует ресурсы, прогоняет аннотации).

    Поднимается приложение прямо из исходников — без явного создания JAR.

    Подтягиваются зависимости на лету из локального Maven-репозитория (~/.m2/repository).

    Передаются в приложение все свойства (из application.yml).

    Проект остается в «живом» состоянии — пока не остановим процесс (Ctrl+C).

Приложение открывается по адресу: http://localhost:8085/products


2. Запуск Executable JAR в Docker-контейнер с открытым веб-портом для доступа из браузера (8085) с использованием Docker Compose.

В корне проектов должны быть созданы файлы - Dockerfile, в котором описываются инструкции для сборки образа Docker — шаги, которые скажут Docker, как подготовить среду для приложения.

Также в корне проекта должен быть создан файл docker-compose.yml (доступен в репозитории), в котором описывается, как запускать контейнер — с его настройками, сетями, томами и переменными окружения. 
  
DockerCompose должны быть установлены и запущены на компьютере. Проверить можно командой:

    •	Версия Docker: docker --version
    •	Версия Docker Compose: docker compose version


Запуск приложения возможен одним из следующих вариантов:

    2.1. Скачать приложения из репозитория ДокерХаб.

    Запустить приложение командой: docker-compose up --build.


    2.2. Чистим и собираем fat JAR - ы из исходников командой: mvn clean package -DskipTests

    После этого в папках target/ появится файлы

    Затем нужно запустить через Docker Compose командой:	docker compose up --build.

    После этого приложение будет доступно в браузере по адресу: http://localhost:8085/products


## Тестирование

Приложение покрыто модульными и интеграционными тестами с использованием Spring Boot Test, Spring WebFlux и Spring Data R2DBC и кеширования контекстов.

Интеграционное тестирвание выполняется в условиях, максимально приближенных к реальной среде выполнения приложения с использованием Testcontainers с PostgreSQL для Spring Boot.

Этот метод имеет следующие преимущества:

    Изоляция: тесты не зависят от локальной базы данных или внешних сервисов.

    Воспроизводимость: одна и та же конфигурация базы для всех тестов и разработчиков.

    Чистая база: можно легко сбрасывать состояние между тестами или перед каждым запуском.

    Быстрый старт/стоп: контейнер запускается и останавливается быстро.

    Контроллеры и сервисы подключаются к реальному слою данных через полноценный Spring-контекст.

Всего для покрытия Приложения тестами (юнит-, интеграционными) создано 48 тест.в (37 - тестироание основного приложени и 11 сервиса платежей)

Запуск всех тестов выполняется командой: mvn test

Запуск отдельно класса с тестами командой: mvn test -Dtest=TestClassName

Результаты тестирования:

Основное приложение:


![Результаты тестирования](img/paymentServiceTest.jpg)


Сервис платежей:


![Результаты тестирования](img/storefrontTest.jpg)




## Скрины основных страниц приложения:

Главная страница прилоржения:

![Главная страница](img/products.jpg)

Страница товара:

![Страница товара](img/product.jpg)

Страница корзины:

![Страница корзины](img/cart.jpg)

Страница заказа:

![Страница заказа](img/order.jpg)

Страница заказов:

![Страница заказов](img/orders.jpg)

Страница добавления товара:

![Страница добавления](img/product-add.jpg)